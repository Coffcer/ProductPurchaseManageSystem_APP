<script>
    /**
     * Select2 component for Vue
     */

    // select2不支持webpack，必须手动通过<script>引入select2
    import 'select2';

    export default {
        props: {
            // 占位符
            placeholder: String,
            // 多选模式下最多选择几个
            max: Number,
            // 是否开启标签模式
            tags: {
                type: Boolean,
                default: false
            },
            // 是否多选
            multiple: {
                type: Boolean,
                default: false
            },
            // 是否禁用
            disabled: {
                type: Boolean,
                default: false
            },
            // 是否显示搜索
            // 传入Boolean表示是否显示， Number表示超过了指定options数才显示搜索
            search: {
                type: null,
                default: true
            },
            // options，格式同select2
            data: null,
            // 选中的值
            model: null,
            // 皮肤
            theme: {
                type: String,
                default: 'bootstrap'
            },
            // 自定义select2Options
            select2Options: null
        },
        ready () {
            let $element = $(this.$el),
                options = {};

            // 自定义选项
            if (this.select2Options) {
                options = this.select2Options;
            }
            // 组装select2选项
            else {
                if (this.data) {
                    options.data = this.data;
                }

                if (this.placeholder != null) {
                    options.placeholder = this.placeholder;
                }

                if (this.max != null) {
                    options.maximumSelectionLength = this.max;
                }

                if (this.tags) {
                    options.tags = this.tags;
                }

                // 关闭搜索
                if (this.search === false) {
                    options.minimumResultsForSearch = 'Infinity';
                }
                // 超过n条才显示搜索 
                else if (typeof this.search === Number) {
                    options.minimumResultsForSearch = this.search;
                }

                options.theme = this.theme;

                $element.prop("disabled", this.disabled);
            }

            $element.select2(options);

            // 默认选中
            if (this.model) {
                $element.val(this.model);
                $element.trigger('change');
            }

            this.bindEvent();
        },
        methods: {
            bindEvent () {
                let $element = $(this.$el);

                $element.on('change', () => {
                    this.model = $element.val();
                    this.$emit('change', $element.val());
                });
            }
        }
    };
</script>

<template>
    <select class="form-control select2" :multiple="multiple" style="width: 100%">
    </select>
</template>

<style src="select2/dist/css/select2.css"></style>
<style src="./select2-bootstrap.min.css"></style>