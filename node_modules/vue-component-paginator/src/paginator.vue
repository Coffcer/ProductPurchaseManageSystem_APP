<script >
    /**
     * jqPaginator for Vue
     */

    import './jqPaginator.min';

    export default {
        props: {
            pageNum: {
                type: Number,
                default: 1
            },
            pageSize: {
                type: Number,
                default: 10
            },
            count: {
                type: Number,
                default: 1
            },
            visibleCount: {
                type: Number,
                default: 7
            },
            showInfo: {
                type: Boolean,
                default: true
            }
        },
        computed: {
            // 当前页最前一行的index
            pageBegin () {
                return this.pageSize * (this.pageNum - 1);
            },
            // 当前页最后一行的index
            pageEnd () {
                if (this.pageNum === this.pageCount) {
                    return this.count;
                }

                return this.pageBegin + this.pageSize;
            },
            // 总页数
            pageCount () {
                if (this.count < this.pageSize) {
                    return 1;
                }

                return this.count % this.pageSize === 0 
                    ? this.count / this.pageSize
                    : parseInt(this.count / this.pageSize) + 1;
            },
            className () {
                return {
                    'col-md-7': this.showInfo,
                    'col-sm-7': this.showInfo,
                    'col-md-12': !this.showInfo,
                    'center': !this.showInfo
                };
            }
        },
        ready () {
            this.$page = $(this.$els.pagination);

            this.$page.jqPaginator({
                totalCounts: this.count,
                pageSize: this.pageSize,
                visiblePages: this.visibleCount,
                currentPage: this.pageNum,
                onPageChange: (num, event) => {
                    if (event === 'change') {
                        this.pageNum = num;
                        this.$emit('change', num);
                    }
                }
            });
        },
        watch: {
            count () {
                this.$page.jqPaginator('option', {
                    totalCounts: this.count || 1
                });
            },
            pageNum () {
                this.$page.jqPaginator('option', {
                    currentPage: this.pageNum
                });
            }
        }
    };
</script>

<template>
    <div class="row">
        <div class="col-md-5 col-sm-5" v-if="showInfo">
            <div class="info">
                第 {{pageBegin + 1}} 到 {{pageEnd}} 条，共 {{count}} 条记录
            </div>
        </div>
        <div class="page" :class="className">
            <div class="pagination" v-el:pagination></div>
        </div>
    </div>
</template>

<style scoped>
    .info {
        padding-top: 8px;
        white-space: nowrap;
    }
    .page {
        text-align: right;
    }
    .pagination {
        margin: 0;
    }

    @media (max-width: 768px) {
        .info {
            margin-bottom: 10px;
            text-align: center;
        }
        .page {
            text-align: center;
        }
    }

    .center {
        text-align: center;
    }
</style>