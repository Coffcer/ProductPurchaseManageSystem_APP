<script>
    /**
     * Datepicker by Vue
     */

    import 'bootstrap-daterangepicker';
    import moment from 'moment';

    export default {
        props: {
            // model为数组则多选，为Date对象则单选
            model: {
                type: null
            },
            // 展开方向
            direction: {
                type: String,
                default: 'left'
            },
            // 格式
            format: {
                type: String,
                default: 'YYYY-MM-DD'
            },
            // 最高选择日期
            maxDate: {
                type: Object,
                default: () => new Date()
            },
            // 小图标className
            iconClass: {
                type: String,
                default: 'btn green btn-outline'
            }
        },
        computed: {
            formatModel () {
                // 单选
                if (this.isSingle) {
                    return this.getFormatDate(this.model);
                }

                // 多选
                return this.getFormatDate(this.model[0]) + ' - ' + this.getFormatDate(this.model[1]);
            },
            isSingle () {
                return this.model instanceof Date;
            }
        },
        ready () {
            this.bind();
        },
        methods: {
            bind () {
                let options = {
                    autoApply: true,
                    locale: {
                        format: 'YYYY-MM-DD',
                        separator: " 至 ",
                        applyLabel: "确定",
                        cancelLabel: "取消",
                        fromLabel: "从",
                        toLabel: "至",
                        customRangeLabel: "自定义",
                        daysOfWeek: ["日", "一", "二", "三", "四", "五", "六"],
                        monthNames: [
                            "一月", "二月", "三月", "四月", "五月", "六月", "七月",
                            "八月", "九月", "十月", "十一月", "十二月"
                        ],
                        firstDay: 1,
                    }
                };

                if (this.maxDate) {
                    options.maxDate = this.maxDate;
                }

                // 单选
                if (this.isSingle) {
                    options.singleDatePicker = true;
                    options.startDate = options.endDate = this.getFormatDate(this.model);
                }
                // 多选
                else {
                    options.startDate = this.getFormatDate(this.model[0]);
                    options.endDate = this.getFormatDate(this.model[1]);
                }

                $(this.$el).daterangepicker(options, (start, end) => {
                    let model = this.isSingle ? start._d : [start._d, end._d];

                    this.$emit('change', model);
                    this.model = model;
                });
            },
            getFormatDate (model) {
                if (model) {
                    return moment(model).format(this.format);
                }
            }
        }
    };
</script>

<template>
    <div class="input-group">
        <input type="text" class="form-control timepicker timepicker-no-seconds" readonly :value="formatModel">
        <span class="input-group-btn">
            <button :class="iconClass" type="button">
                <i class="fa fa-clock-o"></i>
            </button>
        </span>
    </div>
</template>

<style scoped>
    .form-control {
        background-color: #fff;
        cursor: pointer;
    }
</style>
<style src="bootstrap-daterangepicker/daterangepicker.css"></style>